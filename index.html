<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾›åº”å•†ä¼šè¯æ‹‰é»‘</title>
    <style>
        :root {
            --primary-color: #1890ff;
            --warning-color: #faad14;
            --danger-color: #ff4d4f;
            --success-color: #52c41a;
            --border-color: #e8e8e8;
            --bg-color: #f0f2f5;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* é¡¶éƒ¨é¢åŒ…å±‘ */
        .breadcrumb {
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        .breadcrumb b {
            color: #333;
        }

        /* ç­›é€‰ä¸æ“ä½œåŒº */
        .layout-container {
            background: #fff;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .action-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            align-items: center;
        }

        .search-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; /* é˜²æ­¢å®½åº¦ä¸å¤Ÿæ¢è¡Œ */
        }

        .input-control {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            width: 250px; /* ç¨å¾®åŠ å®½ä»¥é€‚åº”æ›´å¤šæœç´¢å†…å®¹ */
            transition: all 0.3s;
        }
        .input-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(24, 144, 255, 0.2);
        }

        .btn {
            padding: 6px 16px;
            border: 1px solid #d9d9d9;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn:hover { color: var(--primary-color); border-color: var(--primary-color); }
        
        .btn-primary {
            background: var(--primary-color);
            color: #fff;
            border: none;
        }
        .btn-primary:hover { background: #40a9ff; color: #fff; }

        .btn-danger {
            background: #fff;
            color: var(--danger-color);
            border-color: #ffccc7;
        }
        .btn-danger:hover {
            background: #fff1f0;
            border-color: var(--danger-color);
        }

        /* è¡¨æ ¼åŒº */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th {
            background: #fafafa;
            padding: 14px 16px;
            text-align: left;
            font-weight: 500;
            color: #555;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }
        td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            color: #333;
        }
        tr:hover td { background: #fdfdfd; }
        
        .reason-text {
            color: #666;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .tag-blacklist {
            background: #fff1f0;
            border: 1px solid #ffa39e;
            color: #cf1322;
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 12px;
        }
        .tag-whitelist {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
            padding: 2px 8px;
            border-radius: 2px;
            font-size: 12px;
        }
        
        /* æ‹¦æˆªæ•°ç‚¹å‡»æ ·å¼ */
        .intercept-count {
            font-weight: bold;
            color: #333;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: #ccc;
        }
        .intercept-count:hover {
            color: var(--primary-color);
            text-decoration-color: var(--primary-color);
        }

        /* æ–°å¢ç±»å‹æ ‡ç­¾æ ·å¼ */
        .type-tag {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 2px;
            font-size: 11px;
            margin-right: 4px;
            border: 1px solid transparent;
        }
        .type-sourcing { background: #e6f7ff; border-color: #91d5ff; color: #1890ff; } /* æ‰¾è´§ */
        .type-check { background: #f6ffed; border-color: #b7eb8f; color: #52c41a; } /* æŸ¥å• */
        .type-notify { background: #fff7e6; border-color: #ffd591; color: #fa8c16; } /* é€šçŸ¥ */
        .type-order { background: #fff1f0; border-color: #ffa39e; color: #cf1322; font-weight: bold; } /* ç¦æ­¢ä¸‹å• - ä¸¥é‡ */

        .action-link {
            color: var(--primary-color);
            cursor: pointer;
            margin-right: 12px;
        }
        .action-link.delete { color: var(--danger-color); }

        /* Modal å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: #fff;
            width: 500px;
            border-radius: 8px;
            box-shadow: 0 9px 28px rgba(0,0,0,0.05);
            animation: fadeIn 0.2s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        .modal-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
        }
        .modal-body { padding: 24px; }
        .modal-footer {
            padding: 12px 24px;
            border-top: 1px solid var(--border-color);
            text-align: right;
            background: #fbfbfb;
            border-radius: 0 0 8px 8px;
        }

        .form-item { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-input-full { width: 100%; box-sizing: border-box; }
        textarea.form-input-full { height: 80px; resize: vertical; }
        
        /* Checkbox group styles */
        .checkbox-group {
            display: flex;
            gap: 16px;
            margin-top: 6px;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            cursor: pointer;
        }
        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }

        /* æœç´¢ç»“æœä¸‹æ‹‰æ¨¡æ‹Ÿ */
        .search-results {
            border: 1px solid #d9d9d9;
            border-top: none;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            width: 450px; /* ç•¥å°äºmodalå®½ */
            background: #fff;
            z-index: 10;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: none;
        }
        .search-result-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
        }
        .search-result-item:hover { background: #e6f7ff; }

        /* å¤šé€‰ä¸‹æ‹‰æ ·å¼ */
        .multi-select {
            position: relative;
            min-width: 120px;
            display: inline-block;
        }
        .select-trigger {
            padding: 6px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            background: #fff;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }
        .select-trigger:hover { border-color: var(--primary-color); }
        .select-options {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 100%;
            white-space: nowrap;
            background: #fff;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 100;
            margin-top: 4px;
            padding: 4px 0;
            display: none;
        }
        .select-options label {
            display: block;
            padding: 5px 12px;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .select-options label:hover { background: #f5f5f5; }
        .select-options input[type="checkbox"] { margin: 0; }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* Toast æ¶ˆæ¯æç¤º */
        .toast-message {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 10px 24px;
            border-radius: 4px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            pointer-events: none;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .toast-message.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* åˆ†é¡µæ ·å¼ */
        .pagination {
            display: flex;
            justify-content: flex-end;
            padding-top: 20px;
            align-items: center;
        }
        .page-item {
            display: inline-block;
            padding: 5px 12px;
            border: 1px solid #d9d9d9;
            margin-left: 8px;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            font-size: 13px;
        }
        .page-item:hover:not(.disabled) {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .page-item.active {
            background: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
        }
        .page-item.disabled {
            color: #ccc;
            cursor: not-allowed;
            background: #f5f5f5;
            border-color: #d9d9d9;
        }

        /* ç­›é€‰åŒºæ–°æ ·å¼ */
        .filter-section {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            border: 1px solid #eee;
        }
        .filter-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .filter-row:last-child { margin-bottom: 0; }
        .filter-label {
            width: 100px;
            font-weight: 500;
            color: #333;
            text-align: right;
            margin-right: 12px;
        }
        .filter-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .radio-label, .check-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <div class="breadcrumb">AIæ’ä»¶ / <b>ä¾›åº”å•†ä¼šè¯æ‹‰é»‘</b></div>

    <div class="layout-container">
        <!-- ç­›é€‰åŒºåŸŸ -->
        <div class="filter-section">
            <div class="filter-row">
                <div class="filter-label">æ‹‰é»‘çŠ¶æ€:</div>
                <div class="filter-content">
                    <label class="radio-label"><input type="radio" name="filterStatus" value="all" checked onchange="resetPageAndRender()"> å…¨éƒ¨</label>
                    <label class="radio-label"><input type="radio" name="filterStatus" value="active" onchange="resetPageAndRender()"> å·²æ‹‰é»‘</label>
                    <label class="radio-label"><input type="radio" name="filterStatus" value="inactive" onchange="resetPageAndRender()"> å·²æ¢å¤</label>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-label">æ‹‰é»‘ç±»å‹:</div>
                <div class="filter-content">
                    <label class="check-label"><input type="checkbox" name="filterType" value="æ‰¾è´§" checked onchange="resetPageAndRender()"> æ‰¾è´§</label>
                    <label class="check-label"><input type="checkbox" name="filterType" value="æŸ¥å•" checked onchange="resetPageAndRender()"> æŸ¥å•</label>
                    <label class="check-label"><input type="checkbox" name="filterType" value="é€šçŸ¥" checked onchange="resetPageAndRender()"> é€šçŸ¥</label>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-label">ä¾›åº”å•†æ—ºæ—ºå·:</div>
                <div class="filter-content" style="flex: 1; justify-content: space-between;">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="input-control" placeholder="è¾“å…¥æ—ºæ—ºå·/å…¬å¸å/IDæ¨¡ç³Šæœç´¢" id="searchInput" style="width: 250px;">
                        <button class="btn btn-primary" onclick="resetPageAndRender()">æœç´¢</button>
                        <button class="btn" onclick="resetSearch()">é‡ç½®</button>
                    </div>
                    <button class="btn btn-danger" onclick="addBlacklist()">+ æ–°å¢æ‹‰é»‘ä¾›åº”å•†</button>
                </div>
            </div>
        </div>

        <!-- åˆ—è¡¨ -->
        <table>
            <thead>
                <tr>
                    <th width="120">ä¾›åº”å•†ID</th>
                    <th width="150">ä¾›åº”å•†æ—ºæ—ºå·</th>
                    <th width="200">ä¾›åº”å•†å…¬å¸åç§°</th>
                    <th width="150">æ‹‰é»‘ç±»å‹</th>
                    <th width="160">æœ¬æœˆæ‹¦æˆª</th>
                    <th>æ‹‰é»‘åŸå› </th>
                    <th width="140">æ‹‰é»‘æ—¶é—´</th>
                    <th width="140">æ¢å¤æ­£å¸¸æ—¶é—´</th>
                    <th width="80">æ“ä½œäºº</th>
                    <th width="80">æ‹‰é»‘çŠ¶æ€</th>
                    <th width="120">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="blacklistBody">
                <!-- JS æ¸²æŸ“ -->
            </tbody>
        </table>
        
        <div id="emptyState" class="empty-state" style="display: none;">
            æš‚æ— æ‹‰é»‘æ•°æ®
        </div>

        <!-- åˆ†é¡µ -->
        <div class="pagination" id="pagination">
            <!-- JS æ¸²æŸ“åˆ†é¡µ -->
        </div>

        <div style="margin-top: 20px; text-align: center; color: #999; font-size: 13px;">
            å½“å‰ä»…å±•ç¤ºé—®è¯¢æ‹‰é»‘çš„ä¾›åº”å•†åˆ—è¡¨ï¼Œå¦‚éœ€æŸ¥çœ‹ç¦æ­¢ä¸‹å•çš„ä¾›åº”å•†åˆ—è¡¨ï¼Œè¯·å‰å¾€â€œä¾›åº”å•†ç®¡ç†â€åˆ—è¡¨æŸ¥çœ‹
        </div>
    </div>

    <!-- æ–°å¢å¼¹çª— -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <div class="modal-header">
                æ–°å¢æ‹‰é»‘ä¾›åº”å•†
                <span style="cursor:pointer;color:#999" onclick="closeModal()">âœ•</span>
            </div>
            <div class="modal-body">
                <div class="form-item" style="position: relative;">
                    <label class="form-label">ä¾›åº”å•†æ—ºæ—ºå· <span style="color:red">*</span></label>
                    <input type="text" class="input-control form-input-full" id="supplierSearch" placeholder="è¾“å…¥æ—ºæ—ºå·æˆ–å…¬å¸åæœç´¢..." oninput="simulateSearch(this.value)">
                    <div class="search-results" id="searchResults">
                        <!-- æœç´¢ç»“æœ -->
                    </div>
                </div>
                <div class="form-item">
                    <label class="form-label">ä¾›åº”å•†å…¬å¸åç§°</label>
                    <input type="text" class="input-control form-input-full" id="companyNameInput" placeholder="è¯·è¾“å…¥å…¬å¸åç§°ï¼ˆé€‰å¡«ï¼‰">
                </div>
                
                <div class="form-item">
                    <label class="form-label">æ‹‰é»‘ç±»å‹ <span style="color:red">*</span></label>
                    <div class="checkbox-group" style="flex-wrap: wrap;">
                        <label class="checkbox-label"><input type="checkbox" name="blockType" value="æ‰¾è´§" checked> æ‰¾è´§</label>
                        <label class="checkbox-label"><input type="checkbox" name="blockType" value="æŸ¥å•" checked> æŸ¥å•</label>
                        <label class="checkbox-label"><input type="checkbox" name="blockType" value="é€šçŸ¥" checked> é€šçŸ¥</label>
                    </div>
                    <div style="font-size: 12px; color: #999; margin-top: 6px;">æ³¨ï¼šå‹¾é€‰ç›¸åº”ç±»å‹ï¼Œç³»ç»Ÿå°†å±è”½å¯¹åº”åœºæ™¯çš„ä»»åŠ¡ã€‚</div>
                </div>

                <div class="form-item">
                    <label class="form-label">æ‹‰é»‘åŸå›  <span style="color:red">*</span></label>
                    <textarea class="input-control form-input-full" id="blockReason" placeholder="ä¾‹å¦‚ï¼šå‘è´§ææ…¢ï¼Œç»å¸¸ç¼ºè´§ï¼Œæ€åº¦æ¶åŠ£ç­‰..."></textarea>
                    <div style="font-size: 12px; color: #ff4d4f; margin-top: 4px;">âš ï¸ æ‹‰é»‘åï¼Œç³»ç»Ÿå°†ä¸å†å¯¹æ­¤ä¾›åº”å•†ç”Ÿæˆä»»ä½•è‡ªåŠ¨é—®è¯¢ä»»åŠ¡ï¼</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveBlacklist()">ç¡®è®¤æ‹‰é»‘</button>
            </div>
        </div>
    </div>

    <!-- æ‹¦æˆªè¯¦æƒ…å¼¹çª— -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal" style="width: 600px;">
            <div class="modal-header">
                <div>æ‹¦æˆªæ˜ç»† - <span id="detailSupplierName"></span></div>
                <span style="cursor:pointer;color:#999" onclick="closeDetailModal()">âœ•</span>
            </div>
            <div class="modal-body" style="padding: 0;">
                <table style="border: none;">
                    <thead>
                        <tr>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0;">æ‹¦æˆªæ—¶é—´</th>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0;">ä¸šåŠ¡ç±»å‹</th>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0;">è§¦å‘è§„åˆ™</th>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0;">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="detailBody">
                        <!-- JS æ¸²æŸ“ -->
                    </tbody>
                </table>
                <div id="detailEmpty" style="text-align: center; padding: 30px; color: #999; display: none;">
                    æš‚æ— æœ¬æœˆæ‹¦æˆªè®°å½•
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeDetailModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- æ“ä½œæ—¥å¿—å¼¹çª— -->
    <div class="modal-overlay" id="logModal">
        <div class="modal" style="width: 700px;">
            <div class="modal-header">
                <div>æ“ä½œæ—¥å¿—</div>
                <span style="cursor:pointer;color:#999" onclick="closeLogModal()">âœ•</span>
            </div>
            <div class="modal-body" style="padding: 0;">
                <table style="border: none;">
                    <thead>
                        <tr>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0; width: 160px;">æ“ä½œæ—¶é—´</th>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0; width: 100px;">æ“ä½œäºº</th>
                            <th style="background: #fff; border-bottom: 2px solid #f0f0f0;">æ“ä½œå†…å®¹</th>
                        </tr>
                    </thead>
                    <tbody id="logBody">
                        <!-- JS æ¸²æŸ“ -->
                    </tbody>
                </table>
                <div id="logEmpty" style="text-align: center; padding: 30px; color: #999; display: none;">
                    æš‚æ— æ“ä½œè®°å½•
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeLogModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå·²å­˜åœ¨çš„æ•°æ®
        // å¢åŠ  breakdown å­—æ®µæ¨¡æ‹Ÿå„ç±»å‹æ‹¦æˆªæ•°
        let blacklistData = [
            { recordId: 'rec_0', id: 'SUP_9999', wangwang: 'bad_seller_007', companyName: 'è¯šä¿¡ç¼ºå¤±è´¸æ˜“è¡Œ', types: ['æ‰¾è´§', 'æŸ¥å•', 'é€šçŸ¥'], interceptCount: 0, reason: 'æ¶‰å«Œå”®å‡ï¼Œå¹³å°å·²é€šæŠ¥', time: '2025-01-20 16:00:00', releaseTime: '', operator: 'é£æ§ç³»ç»Ÿ', status: 'active' },
            { recordId: 'rec_1', id: 'SUP_1001', wangwang: 'tb_shop_1001', companyName: 'ä¹‰ä¹Œå¸‚å°å•†å“ç²¾é€‰åº—', types: ['æ‰¾è´§', 'æŸ¥å•'], interceptCount: 42, breakdown: { 'æ‰¾è´§': 12, 'æŸ¥å•': 30 }, reason: 'å¤šæ¬¡å‘é”™è´§ï¼Œä¸”æ‹’ç»æ‰¿æ‹…è¿è´¹', time: '2025-09-01 10:22:11', releaseTime: '', operator: 'å¼ ä¸‰', status: 'active' },
            { recordId: 'rec_2', id: 'SUP_2001', wangwang: 'hz_silk_direct', companyName: 'æ­å·ä¸ç»¸ç›´ä¾›', types: ['æŸ¥å•'], interceptCount: 5, breakdown: { 'æŸ¥å•': 5 }, reason: 'é…åˆåº¦ä½', time: '2024-12-11 09:30:00', releaseTime: '2025-01-01 09:00:00', operator: 'æå››', status: 'inactive' },
            { recordId: 'rec_3', id: 'SUP_2002', wangwang: 'sh_stationary_fac', companyName: 'ä¸Šæµ·æ–‡å…·ç”¨å“åˆ¶é€ å‚', types: ['æ‰¾è´§'], interceptCount: 1, breakdown: { 'æ‰¾è´§': 1 }, reason: 'ä¸´æ—¶ç¼ºè´§', time: '2024-11-20 14:00:00', releaseTime: '2024-11-25 10:00:00', operator: 'ç‹äº”', status: 'inactive' },
            // ç”Ÿæˆæ›´å¤šæ¨¡æ‹Ÿæ•°æ®ä»¥æµ‹è¯•åˆ†é¡µ
            ...Array.from({ length: 25 }, (_, i) => ({
                recordId: `rec_mock_${i}`,
                id: `SUP_${3000+i}`,
                wangwang: `mock_supplier_${i}`,
                companyName: `æ¨¡æ‹Ÿä¾›åº”å•†${i}å·å…¬å¸`,
                types: i % 2 === 0 ? ['æ‰¾è´§'] : ['æŸ¥å•', 'é€šçŸ¥'],
                interceptCount: i % 3 === 0 ? 10 : 0,
                breakdown: i % 3 === 0 ? (i % 2 === 0 ? {'æ‰¾è´§': 10} : {'æŸ¥å•': 6, 'é€šçŸ¥': 4}) : {},
                reason: 'æ¨¡æ‹Ÿæ‰¹é‡æ•°æ®æµ‹è¯•åˆ†é¡µæ˜¾ç¤º',
                time: '2024-10-01 12:00:00',
                releaseTime: i % 4 === 0 ? '2024-10-05 12:00:00' : '',
                operator: 'ç³»ç»Ÿæµ‹è¯•',
                status: i % 4 === 0 ? 'inactive' : 'active'
            }))
        ];

        // æ¨¡æ‹Ÿå…¨é‡ä¾›åº”å•†åº“ï¼ˆç”¨äºæœç´¢ï¼‰
        const supplierDb = [
            { id: 'SUP_1001', wangwang: 'tb_shop_1001', companyName: 'ä¹‰ä¹Œå¸‚å°å•†å“ç²¾é€‰åº—' },
            { id: 'SUP_1002', wangwang: 'gz_clothing_wh', companyName: 'å¹¿å·æœè£…æ‰¹å‘æ€»ä»“' },
            { id: 'SUP_1003', wangwang: 'sz_elec_factory', companyName: 'æ·±åœ³ç”µå­å…ƒä»¶å‚' },
            { id: 'SUP_1004', wangwang: 'hz_textile_ltd', companyName: 'æ­å·çººç»‡æœ‰é™å…¬å¸' },
            { id: 'SUP_2001', wangwang: 'hz_silk_direct', companyName: 'æ­å·ä¸ç»¸ç›´ä¾›' },
            { id: 'SUP_2002', wangwang: 'sh_stationary_fac', companyName: 'ä¸Šæµ·æ–‡å…·ç”¨å“åˆ¶é€ å‚' },
            { id: 'SUP_2003', wangwang: 'yiwu_acc_c', companyName: 'ä¹‰ä¹Œé¥°å“é…ä»¶CåŒº' },
            { id: 'SUP_2004', wangwang: 'sz_digi_3c', companyName: 'æ·±åœ³æ•°ç 3Cä¸“è¥' },
            { id: 'SUP_2005', wangwang: 'bj_specialty', companyName: 'åŒ—äº¬ç‰¹äº§ä»£å‘' },
            { id: 'SUP_9999', wangwang: 'bad_seller_007', companyName: 'è¯šä¿¡ç¼ºå¤±è´¸æ˜“è¡Œ' }
        ];

        let selectedSupplier = null;
        
        // åˆ†é¡µç›¸å…³å˜é‡
        let currentPage = 1;
        const pageSize = 10;
        let totalItems = 0;

        // Toast æ¶ˆæ¯æç¤ºå‡½æ•°
        function showToast(msg, duration = 3000) {
            const div = document.createElement('div');
            div.className = 'toast-message';
            div.innerText = msg;
            document.body.appendChild(div);
            // è§¦å‘åŠ¨ç”»
            requestAnimationFrame(() => {
                div.classList.add('show');
            });
            setTimeout(() => {
                div.classList.remove('show');
                setTimeout(() => div.remove(), 300);
            }, duration);
        }

        // æ¨¡æ‹Ÿæ‹¦æˆªè¯¦ç»†æ•°æ®
        function generateMockLogs(count) {
            const logs = [];
            const types = ['æ‰¾è´§', 'æŸ¥å•', 'é€šçŸ¥'];
            for(let i=0; i<count; i++) {
                logs.push({
                    time: `2025-02-${String(Math.floor(Math.random()*28)+1).padStart(2,'0')} ${String(Math.floor(Math.random()*14)+8).padStart(2,'0')}:${String(Math.floor(Math.random()*59)).padStart(2,'0')}`,
                    type: types[Math.floor(Math.random() * types.length)],
                    rule: 'é»‘åå•å‘½ä¸­',
                    status: 'å·²æ‹¦æˆª'
                });
            }
            // æŒ‰æ—¶é—´å€’åº
            return logs.sort((a,b) => new Date(b.time) - new Date(a.time));
        }
        
        // ç¼“å­˜éƒ¨åˆ†æ•°æ®çš„æ—¥å¿—ï¼Œé¿å…æ¯æ¬¡éšæœºå˜åŒ–
        const logCache = {};

        // åˆå§‹åŒ–
        renderTable();

        function resetPageAndRender() {
            currentPage = 1;
            renderTable();
        }

        // æ¸²æŸ“è¡¨æ ¼
        function renderTable() {
            const tbody = document.getElementById('blacklistBody');
            const searchVal = document.getElementById('searchInput').value.trim().toLowerCase();
            
            // è·å–æ–°æ§ä»¶çš„å€¼
            const filterStatus = document.querySelector('input[name="filterStatus"]:checked').value;
            const typeCheckboxes = document.querySelectorAll('input[name="filterType"]:checked');
            const selectedTypes = Array.from(typeCheckboxes).map(cb => cb.value);
            
            const emptyState = document.getElementById('emptyState');
            
            tbody.innerHTML = '';

            let filtered = blacklistData.filter(item => {
                // æ–‡æœ¬æœç´¢
                const matchText = (item.wangwang && item.wangwang.toLowerCase().includes(searchVal)) || 
                                  (item.companyName && item.companyName.toLowerCase().includes(searchVal)) ||
                                  item.id.toLowerCase().includes(searchVal);
                
                // çŠ¶æ€ç­›é€‰
                const matchStatus = filterStatus === 'all' || item.status === filterStatus;

                // ç±»å‹ç­›é€‰
                let matchType = false;
                if (selectedTypes.length === 0) {
                    matchType = false; 
                } else {
                    if (item.types && item.types.some(t => selectedTypes.includes(t))) {
                        matchType = true;
                    }
                }
                
                return matchText && matchStatus && matchType;
            });

            // æ’åº (é»˜è®¤æŒ‰æ‹‰é»‘æ—¶é—´å€’åº)
            filtered.sort((a, b) => new Date(b.time) - new Date(a.time));

            totalItems = filtered.length;
            renderPagination();

            if (totalItems === 0) {
                emptyState.style.display = 'block';
                document.getElementById('pagination').style.display = 'none';
                return;
            }
            emptyState.style.display = 'none';
            document.getElementById('pagination').style.display = 'flex';

            // åˆ†é¡µåˆ‡ç‰‡
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const pageData = filtered.slice(start, end);

            pageData.forEach((item) => {
                // ç±»å‹ Tag
                let typesHtml = '';
                if (item.types && item.types.includes('æ‰¾è´§')) typesHtml += `<span class="type-tag type-sourcing">æ‰¾è´§</span>`;
                if (item.types && item.types.includes('æŸ¥å•')) typesHtml += `<span class="type-tag type-check">æŸ¥å•</span>`;
                if (item.types && item.types.includes('é€šçŸ¥')) typesHtml += `<span class="type-tag type-notify">é€šçŸ¥</span>`;
                if (!typesHtml) typesHtml = '-';

                // æ‹¦æˆªæ•°å±•ç¤º
                let countHtml = '<span style="color:#ccc">0</span>';
                if (item.interceptCount > 0) {
                    if (item.breakdown) {
                        const parts = Object.entries(item.breakdown).map(([k, v]) => `${k}:${v}`).join('ï¼Œ');
                        countHtml = `<span class="intercept-count" onclick="showInterceptDetails('${item.id}', '${item.wangwang}', ${item.interceptCount})">${parts}</span>`;
                    } else {
                        countHtml = `<span class="intercept-count" onclick="showInterceptDetails('${item.id}', '${item.wangwang}', ${item.interceptCount})">${item.interceptCount} å•</span>`;
                    }
                }
                
                const isActive = item.status === 'active';
                const statusHtml = isActive 
                    ? `<span class="tag-blacklist">å·²æ‹‰é»‘</span>` 
                    : `<span class="tag-whitelist">å·²æ¢å¤</span>`;
                
                // æ—¶é—´åˆ—æ‹†åˆ†
                const blockTime = item.time ? item.time.split(' ')[0] : '-';
                const releaseTime = (!isActive && item.releaseTime) ? item.releaseTime.split(' ')[0] : '-';

                const actionHtml = isActive
                    ? `<span class="action-link delete" onclick="releaseBlacklist('${item.recordId}')">è§£é™¤æ‹‰é»‘</span>`
                    : `<span class="action-link" onclick="reBlockSupplier('${item.recordId}')">é‡æ–°æ‹‰é»‘</span>`;
            
                const tr = document.createElement('tr');
                if (!isActive) tr.style.background = '#fafafa';

                tr.innerHTML = `
                    <td>${item.id}</td>
                    <td><b>${item.wangwang}</b></td>
                    <td>${item.companyName || '-'}</td>
                    <td>${typesHtml}</td>
                    <td>${countHtml}</td>
                    <td><div class="reason-text" title="${item.reason}">${item.reason}</div></td>
                    <td>${blockTime}</td>
                    <td style="color:${releaseTime!=='-'?'#52c41a':'#ccc'}">${releaseTime}</td>
                    <td>${item.operator}</td>
                    <td>${statusHtml}</td>
                    <td>${actionHtml}<span class="action-link" onclick="showLog('${item.id}')">æ—¥å¿—</span></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function renderPagination() {
            const container = document.getElementById('pagination');
            container.innerHTML = '';
            
            const totalPages = Math.ceil(totalItems / pageSize);
            if (totalPages <= 1) return;

            const prevBtn = document.createElement('div');
            prevBtn.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevBtn.innerText = '<';
            prevBtn.onclick = () => changePage(currentPage - 1);
            container.appendChild(prevBtn);

            for(let i = 1; i <= totalPages; i++) {
                const p = document.createElement('div');
                p.className = `page-item ${currentPage === i ? 'active' : ''}`;
                p.innerText = i;
                p.onclick = () => changePage(i);
                container.appendChild(p);
            }

            const nextBtn = document.createElement('div');
            nextBtn.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextBtn.innerText = '>';
            nextBtn.onclick = () => changePage(currentPage + 1);
            container.appendChild(nextBtn);
            
            const info = document.createElement('div');
            info.style.marginLeft = '10px';
            info.style.fontSize = '13px';
            info.style.color = '#666';
            info.innerText = `å…± ${totalItems} æ¡`;
            container.appendChild(info);
        }

        function changePage(page) {
            const totalPages = Math.ceil(totalItems / pageSize);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            renderTable();
        }

        function showInterceptDetails(id, name, count) {
             document.getElementById('detailSupplierName').innerText = name;
             let logs = logCache[id];
             if (!logs) {
                 logs = generateMockLogs(count || 5);
                 logCache[id] = logs;
             }
             const tbody = document.getElementById('detailBody');
             const empty = document.getElementById('detailEmpty');
             tbody.innerHTML = '';
             
             if (logs.length === 0) {
                 empty.style.display = 'block';
             } else {
                 empty.style.display = 'none';
                 logs.forEach(log => {
                     const tr = document.createElement('tr');
                     let typeClass = '';
                     if(log.type === 'æ‰¾è´§') typeClass = 'type-sourcing';
                     else if(log.type === 'æŸ¥å•') typeClass = 'type-check';
                     else if(log.type === 'é€šçŸ¥') typeClass = 'type-notify';
                     
                     tr.innerHTML = `
                        <td style="color:#666">${log.time}</td>
                        <td><span class="type-tag ${typeClass}">${log.type}</td>
                        <td>${log.rule}</td>
                        <td><span style="color:#ff4d4f;background:#fff1f0;padding:2px 6px;border-radius:2px;font-size:12px;">ğŸš« ${log.status}</span></td>
                     `;
                     tbody.appendChild(tr);
                 });
             }
             document.getElementById('detailModal').style.display = 'flex';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            document.querySelector(`input[name="filterStatus"][value="all"]`).checked = true;
            document.querySelectorAll(`input[name="filterType"]`).forEach(cb => cb.checked = true);
            resetPageAndRender();
        }

        function addBlacklist() {
            document.getElementById('addModal').style.display = 'flex';
            document.getElementById('supplierSearch').value = '';
            document.getElementById('companyNameInput').value = ''; 
            document.getElementById('blockReason').value = '';
            document.getElementById('searchResults').style.display = 'none';
            document.querySelectorAll('input[name="blockType"]').forEach(cb => cb.checked = true);
            selectedSupplier = null;
        }

        function closeModal() {
            document.getElementById('addModal').style.display = 'none';
        }

        function simulateSearch(val) {
            const resultBox = document.getElementById('searchResults');
            if (!val) {
                resultBox.style.display = 'none';
                return;
            }
            
            const results = supplierDb.filter(s => 
                (s.wangwang.includes(val) || s.companyName.includes(val)) && 
                !blacklistData.find(b => b.id === s.id && b.status === 'active')
            );
            
            if (results.length > 0) {
                resultBox.innerHTML = results.map(s => `
                    <div class="search-result-item" onclick="selectSupplier('${s.id}', '${s.wangwang}', '${s.companyName}')">
                        <span style="font-weight:bold">${s.wangwang}</span> 
                        <span style="color:#666;font-size:12px">(${s.companyName})</span>
                    </div>
                `).join('');
                resultBox.style.display = 'block';
            } else {
                resultBox.innerHTML = '<div style="padding:8px;color:#999">æœªæ‰¾åˆ°åŒ¹é…çš„ä¾›åº”å•†æˆ–å·²åœ¨é»‘åå•ä¸­</div>';
                resultBox.style.display = 'block';
            }
        }

        function selectSupplier(id, wangwang, companyName) {
            selectedSupplier = { id, wangwang, companyName };
            document.getElementById('supplierSearch').value = wangwang;
            document.getElementById('companyNameInput').value = companyName;
            document.getElementById('searchResults').style.display = 'none';
        }

        function saveBlacklist() {
            const reason = document.getElementById('blockReason').value;
            const searchInput = document.getElementById('supplierSearch').value;
            const companyInput = document.getElementById('companyNameInput').value;
            
            const selectedTypes = [];
            document.querySelectorAll('input[name="blockType"]:checked').forEach(cb => {
                selectedTypes.push(cb.value);
            });

            if (!selectedSupplier && !searchInput) {
                showToast('è¯·å¡«å†™ä¾›åº”å•†æ—ºæ—ºå·');
                return;
            }

            if (selectedTypes.length === 0) {
                showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ‹‰é»‘ç±»å‹');
                return;
            }

            const newItem = {
                recordId: 'rec_' + Date.now(),
                id: selectedSupplier ? selectedSupplier.id : ('SUP_NEW_' + Math.floor(Math.random()*1000)),
                wangwang: selectedSupplier ? selectedSupplier.wangwang : searchInput,
                companyName: selectedSupplier ? selectedSupplier.companyName : companyInput,
                types: selectedTypes,
                interceptCount: 0,
                breakdown: {}, 
                reason: reason || 'æœªå¡«å†™åŸå› ',
                time: new Date().toLocaleString().replace(/\//g,'-'),
                releaseTime: '',
                operator: 'å½“å‰ç”¨æˆ·',
                status: 'active'
            };

            blacklistData.unshift(newItem);
            addSystemLog(`æ–°å¢æ‹‰é»‘ä¾›åº”å•†ï¼š${newItem.wangwang} (${newItem.id})`);
            resetPageAndRender();
            closeModal();
            showToast(`å·²å°†ã€${newItem.wangwang}ã€‘åŠ å…¥é»‘åå•`);
        }

        function reBlockSupplier(recordId) {
            const item = blacklistData.find(i => i.recordId === recordId);
            if (!item) return;
            addBlacklist();
            document.getElementById('supplierSearch').value = item.wangwang;
            document.getElementById('companyNameInput').value = item.companyName || '';
            selectedSupplier = { id: item.id, wangwang: item.wangwang, companyName: item.companyName };
        }

        function releaseBlacklist(recordId) {
            if(confirm('ç¡®å®šè¦è§£é™¤è¯¥ä¾›åº”å•†çš„é»‘åå•å—ï¼Ÿ\nè§£é™¤åï¼Œè¯¥ä¾›åº”å•†å°†æ¢å¤æ­£å¸¸ï¼Œå¯ä»¥ç”Ÿæˆé—®è¯¢ä»»åŠ¡ã€‚')) {
                const target = blacklistData.find(item => item.recordId === recordId);
                if (target) {
                    target.status = 'inactive';
                    target.releaseTime = new Date().toLocaleString().replace(/\//g,'-');
                    target.releaseOperator = 'å½“å‰ç”¨æˆ·';
                    addSystemLog(`è§£é™¤æ‹‰é»‘ï¼š${target.wangwang} (${target.id})`);
                    renderTable();
                    showToast(`ä¾›åº”å•†å·²æ¢å¤æ­£å¸¸ï¼`);
                }
            }
        }

        function exportData() {
            // ç®€å•å®ç°
        }

        function showLog(filterId) {
            renderSystemLogs(filterId);
            document.getElementById('logModal').style.display = 'flex';
        }
        function closeLogModal() {
            document.getElementById('logModal').style.display = 'none';
        }
        function renderSystemLogs(filterId) {
            const tbody = document.getElementById('logBody');
            const empty = document.getElementById('logEmpty');
            tbody.innerHTML = '';
            let sortedLogs = [...systemLogs].sort((a, b) => new Date(b.time) - new Date(a.time));
            if (filterId && typeof filterId === 'string') {
                sortedLogs = sortedLogs.filter(log => log.content.includes(filterId));
            }
            if (sortedLogs.length === 0) {
                empty.style.display = 'block';
            } else {
                empty.style.display = 'none';
                sortedLogs.forEach(log => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="color:#666">${log.time}</td>
                        <td>${log.operator}</td>
                        <td>${log.content}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }
        
        function addSystemLog(content) {
             const now = new Date();
             const timeStr = now.getFullYear() + '-' + 
                String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                String(now.getDate()).padStart(2, '0') + ' ' + 
                String(now.getHours()).padStart(2, '0') + ':' + 
                String(now.getMinutes()).padStart(2, '0') + ':' + 
                String(now.getSeconds()).padStart(2, '0');
                
             systemLogs.unshift({
                 id: Date.now(),
                 time: timeStr,
                 operator: 'å½“å‰ç”¨æˆ·',
                 content: content
             });
        }

        let systemLogs = [
            { id: 1, time: '2025-02-02 14:20:01', operator: 'å¼ ä¸‰', content: 'æ–°å¢æ‹‰é»‘ä¾›åº”å•†ï¼šä¹‰ä¹Œå¸‚å°å•†å“ç²¾é€‰åº— (SUP_1001)' },
            { id: 2, time: '2025-02-02 09:15:33', operator: 'æå››', content: 'è§£é™¤æ‹‰é»‘ï¼šæ­å·ä¸ç»¸ç›´ä¾› (SUP_2001)' },
            { id: 3, time: '2025-02-01 16:45:10', operator: 'Admin', content: 'å¯¼å‡ºé»‘åå•æ•°æ®' },
            { id: 4, time: '2025-01-20 16:00:00', operator: 'é£æ§ç³»ç»Ÿ', content: 'è‡ªåŠ¨æ‹‰é»‘ï¼šè¯šä¿¡ç¼ºå¤±è´¸æ˜“è¡Œ (SUP_9999)' }
        ];

        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target.id === 'addModal') closeModal();
        });
        document.getElementById('detailModal').addEventListener('click', (e) => {
            if (e.target.id === 'detailModal') closeDetailModal();
        });
        document.getElementById('logModal').addEventListener('click', (e) => {
            if (e.target.id === 'logModal') closeLogModal();
        });

    </script>
</body>
</html>


